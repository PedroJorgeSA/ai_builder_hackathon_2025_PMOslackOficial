# Fluxo Completo da Aplica√ß√£o - Agents & MCPs

## Vis√£o Geral da Arquitetura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        ECOSSISTEMA COMPLETO                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

         USU√ÅRIO (Slack)
              ‚îÇ
              ‚îÇ Menciona @bot
              ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   SLACK API         ‚îÇ
    ‚îÇ  (Webhook/Polling)  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚îÇ Mensagem detectada
              ‚ñº
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    LANGGRAPH AGENT (Principal)                    ‚ïë
‚ïë                   (langgraph_agent.py)                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
              ‚îÇ
              ‚îÇ process_question()
              ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ ETAPA 1:            ‚îÇ
    ‚îÇ Classifica√ß√£o       ‚îÇ
    ‚îÇ de Inten√ß√£o         ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚ñº
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë              INTENT CLASSIFIER AGENT (Analista)                   ‚ïë
‚ïë              (intent_classifier_agent.py)                         ‚ïë
‚ïë                                                                   ‚ïë
‚ïë  ‚Ä¢ Analisa mensagem em linguagem natural                         ‚ïë
‚ïë  ‚Ä¢ Usa GPT-4o-mini (temp: 0.3)                                   ‚ïë
‚ïë  ‚Ä¢ Identifica MCPs necess√°rios                                   ‚ïë
‚ïë  ‚Ä¢ Extrai par√¢metros                                             ‚ïë
‚ïë  ‚Ä¢ Define prioridades                                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
              ‚îÇ
              ‚îÇ Retorna JSON estruturado
              ‚îÇ {
              ‚îÇ   intent_type: "action",
              ‚îÇ   actions: [{mcp, action, params}],
              ‚îÇ   confidence: 0.95
              ‚îÇ }
              ‚ñº
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    LANGGRAPH AGENT (Principal)                    ‚ïë
‚ïë                   execute_classified_action()                     ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
              ‚îÇ
              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ                  ‚îÇ                  ‚îÇ
              ‚ñº                  ‚ñº                  ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   TRELLO MCP    ‚îÇ  ‚îÇ   GITHUB MCP    ‚îÇ  ‚îÇ  SLACK MCP   ‚îÇ
    ‚îÇ  (API calls)    ‚îÇ  ‚îÇ  (API calls)    ‚îÇ  ‚îÇ (API calls)  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                  ‚îÇ                  ‚îÇ
              ‚ñº                  ‚ñº                  ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Trello API     ‚îÇ  ‚îÇ  GitHub API     ‚îÇ  ‚îÇ  Slack API   ‚îÇ
    ‚îÇ  (REST)         ‚îÇ  ‚îÇ  (REST)         ‚îÇ  ‚îÇ  (WebAPI)    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                  ‚îÇ                  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ Resultados
                            ‚ñº
              ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
              ‚ïë  LANGGRAPH AGENT          ‚ïë
              ‚ïë  (Combina resultados)     ‚ïë
              ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                            ‚îÇ
                            ‚îÇ Resposta formatada
                            ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   SLACK API     ‚îÇ
                    ‚îÇ (post_message)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                      USU√ÅRIO (Slack)
                      ‚úÖ Resposta recebida
```

---

## Fluxo Detalhado Passo a Passo

### üì• FASE 1: RECEP√á√ÉO DA MENSAGEM

**1.1 Polling do Slack (Loop Cont√≠nuo)**
```python
# run_slack_bot() em langgraph_agent.py
while True:
    # A cada 5 segundos
    for channel in channels:
        # Busca √∫ltimas 10 mensagens
        history = get_channel_history()
        
        # Filtra mensagens novas (ap√≥s startup_time)
        if msg_ts > startup_time and msg_id not in processed_messages:
            # Detecta men√ß√£o ao bot
            if '<@' in text:
                process_message()
```

**1.2 Detec√ß√£o de Men√ß√£o**
```python
# Identifica @bot na mensagem
if '<@U09NHUGED5K>' in text:
    # Remove men√ß√£o e palavra "bot"
    question = clean_message(text)
    # question = "criar card Bug na API"
```

---

### üß† FASE 2: CLASSIFICA√á√ÉO DE INTEN√á√ÉO

**2.1 Intent Classifier Agent √© Invocado**
```python
# SlackLangGraphAgent.process_question()
classification = self.intent_classifier.classify_intent(question)
```

**2.2 An√°lise com GPT-4o-mini**

O Intent Classifier envia para GPT-4o-mini:

**Prompt:**
```
Sistema: Voc√™ √© um agente especializado em classificar inten√ß√µes...

Usu√°rio: "criar card Bug na API na lista Backlog"
```

**Resposta do GPT-4o-mini:**
```json
{
  "intent_type": "action",
  "confidence": 0.98,
  "actions": [
    {
      "mcp": "trello",
      "action": "create_card",
      "parameters": {
        "card_name": "Bug na API",
        "target_list": "Backlog"
      },
      "priority": 1,
      "reasoning": "Comando expl√≠cito com todos os par√¢metros"
    }
  ],
  "reasoning": "Inten√ß√£o clara de criar card no Trello",
  "requires_confirmation": false
}
```

**2.3 Valida√ß√£o da Classifica√ß√£o**
```python
# Valida estrutura JSON
if validate_result(classification):
    # Prosseguir
else:
    # Fallback para regex
    _process_with_legacy_logic()
```

---

### ‚öôÔ∏è FASE 3: EXECU√á√ÉO DE A√á√ïES

**3.1 Verifica√ß√£o de Confirma√ß√£o**
```python
if classification.get("requires_confirmation"):
    # Retorna mensagem pedindo mais informa√ß√µes
    return "Preciso de mais detalhes..."
```

**3.2 Execu√ß√£o de A√ß√£o √önica**
```python
if len(actions) == 1:
    result = execute_classified_action(actions[0])
```

**3.3 Execu√ß√£o de M√∫ltiplas A√ß√µes**
```python
if len(actions) > 1:
    # Ordena por prioridade
    sorted_actions = sorted(actions, key=lambda x: x['priority'])
    
    # Executa cada a√ß√£o
    results = []
    for action in sorted_actions:
        result = execute_classified_action(action)
        results.append(result)
    
    # Combina resultados
    return "\n\n".join(results)
```

---

### üîß FASE 4: INTERA√á√ÉO COM MCPs

**4.1 Roteamento para MCP Correto**

```python
def execute_classified_action(action):
    mcp = action["mcp"]
    action_name = action["action"]
    parameters = action["parameters"]
    
    if mcp == "trello":
        # Rotear para Trello
    elif mcp == "github":
        # Rotear para GitHub
    elif mcp == "query":
        # Consulta cross-MCP
```

**4.2 Exemplo: A√ß√£o no Trello**

```python
# MCP: Trello
# A√ß√£o: create_card
# Par√¢metros: {card_name: "Bug na API", target_list: "Backlog"}

# 4.2.1 - Buscar ID da lista
conn = http.client.HTTPSConnection("api.trello.com")
lists = get_lists()
list_id = find_list_by_name("Backlog")  # "68fcf558..."

# 4.2.2 - Criar card (com URL encoding)
encoded_name = quote("Bug na API")
url = f"/1/cards?key={KEY}&token={TOKEN}&name={encoded_name}&idList={list_id}"
conn.request("POST", url)

# 4.2.3 - Processar resposta
response = conn.getresponse()
if response.status == 200:
    return "‚úÖ Card 'Bug na API' criado na lista 'Backlog' com sucesso!"
```

**4.3 Exemplo: Consulta Cross-MCP**

```python
# Query: "qual o status do projeto?"
# MCPs envolvidos: Trello + GitHub

# 4.3.1 - Buscar dados do Trello
trello_data = get_trello_data()
# {
#   "Backlog": 8 cards,
#   "Em Desenvolvimento": 3 cards,
#   ...
# }

# 4.3.2 - Buscar dados do GitHub
github_data = get_github_data()
# {
#   "commits": 45,
#   "issues": 12,
#   ...
# }

# 4.3.3 - Combinar e formatar
result = f"""
üìä STATUS DO PROJETO

üéØ Trello:
  ‚Ä¢ Backlog: 8 cards
  ‚Ä¢ Em Desenvolvimento: 3 cards
  ‚Ä¢ Revis√£o: 2 cards

üíª GitHub:
  ‚Ä¢ Commits recentes: 45
  ‚Ä¢ Issues abertas: 12
"""
```

---

### üì§ FASE 5: RETORNO AO USU√ÅRIO

**5.1 Formata√ß√£o da Resposta**
```python
# Resultado j√° formatado pela a√ß√£o
response = "‚úÖ Card 'Bug na API' criado na lista 'Backlog' com sucesso!"
```

**5.2 Envio para Slack**
```python
def post_to_slack(channel_id, message):
    conn = http.client.HTTPSConnection("slack.com")
    headers = {
        'Authorization': f'Bearer {SLACK_BOT_TOKEN}',
        'Content-Type': 'application/json'
    }
    data = {
        'channel': channel_id,
        'text': message
    }
    conn.request("POST", "/api/chat.postMessage", json.dumps(data), headers)
```

**5.3 Usu√°rio Recebe no Slack**
```
PMO bot APP  18:30:45
‚úÖ Card 'Bug na API' criado na lista 'Backlog' com sucesso!
```

---

## Componentes e Responsabilidades

### 1Ô∏è‚É£ **SlackLangGraphAgent** (Orquestrador Principal)
**Arquivo:** `langgraph_agent.py`

**Responsabilidades:**
- üîÑ Loop de polling do Slack
- üì® Detec√ß√£o de men√ß√µes
- üéØ Coordena√ß√£o de agentes
- ‚öôÔ∏è Execu√ß√£o de a√ß√µes
- üì§ Envio de respostas

**M√©todos Principais:**
- `run_slack_bot()` - Loop principal
- `process_question()` - Processa mensagem
- `execute_classified_action()` - Executa a√ß√£o
- `post_to_slack()` - Envia resposta

---

### 2Ô∏è‚É£ **IntentClassifierAgent** (Analista de Inten√ß√µes)
**Arquivo:** `intent_classifier_agent.py`

**Responsabilidades:**
- üß† An√°lise de linguagem natural
- üè∑Ô∏è Classifica√ß√£o de inten√ß√µes
- üìã Extra√ß√£o de par√¢metros
- üé≤ C√°lculo de confian√ßa
- ‚úÖ Valida√ß√£o de completude

**M√©todos Principais:**
- `classify_intent()` - Classifica mensagem
- `_validate_result()` - Valida estrutura
- `get_action_summary()` - Formata resumo

**Modelo:** GPT-4o-mini (temperature: 0.3)

---

### 3Ô∏è‚É£ **MCPs (Model Context Protocol)**

#### **Trello MCP**
**A√ß√µes Dispon√≠veis:**
- ‚úÖ `create_card` - Criar card
- üîÑ `move_card` - Mover card
- ‚úèÔ∏è `update_card` - Atualizar card
- ‚ùå `delete_card` - Deletar card
- üìã `list_cards` - Listar cards

**API:** Trello REST API
**Autentica√ß√£o:** API Key + Token

#### **GitHub MCP**
**A√ß√µes Dispon√≠veis:**
- üìù `list_commits` - Listar commits
- üêõ `list_issues` - Listar issues
- üì¶ `get_repo_info` - Info do repo
- ‚ûï `create_issue` - Criar issue

**API:** GitHub REST API
**Autentica√ß√£o:** Personal Access Token

#### **Slack MCP**
**A√ß√µes Dispon√≠veis:**
- üí¨ `post_message` - Enviar mensagem
- üìú `get_history` - Buscar hist√≥rico
- üìã `list_channels` - Listar canais

**API:** Slack Web API
**Autentica√ß√£o:** Bot Token

---

## Fluxos de Uso Comuns

### üìù Caso 1: Criar Card Simples

```
Usu√°rio: "@bot criar card Bug cr√≠tico na lista Backlog"
    ‚Üì
[Intent Classifier]
  Inten√ß√£o: ACTION
  MCP: Trello
  A√ß√£o: create_card
  Par√¢metros: {name: "Bug cr√≠tico", list: "Backlog"}
    ‚Üì
[Execute Action]
  1. Buscar ID da lista "Backlog"
  2. Codificar nome (URL encoding)
  3. POST /1/cards
    ‚Üì
[Resultado]
  ‚úÖ Card 'Bug cr√≠tico' criado na lista 'Backlog' com sucesso!
```

---

### üîÑ Caso 2: Linguagem Natural

```
Usu√°rio: "@bot o card de login est√° pronto"
    ‚Üì
[Intent Classifier]
  Inten√ß√£o: ACTION (inferida)
  MCP: Trello
  A√ß√£o: move_card
  Par√¢metros: {name: "login", target: "Revis√£o de c√≥digo"}
  Reasoning: "Usu√°rio indica conclus√£o ‚Üí move para revis√£o"
    ‚Üì
[Execute Action]
  1. Buscar card "login"
  2. Buscar lista "Revis√£o de c√≥digo"
  3. PUT /1/cards/{id}
    ‚Üì
[Resultado]
  ‚úÖ Card 'login' movido para 'Revis√£o de c√≥digo' com sucesso!
```

---

### üîç Caso 3: M√∫ltiplas Consultas

```
Usu√°rio: "@bot quantos cards temos e quais os √∫ltimos commits?"
    ‚Üì
[Intent Classifier]
  Inten√ß√£o: QUERY
  A√ß√µes:
    1. [Trello] list_cards (priority: 1)
    2. [GitHub] list_commits (priority: 2)
    ‚Üì
[Execute Actions]
  A√ß√£o 1:
    GET /1/boards/{id}/cards
    Contar cards
    ‚Üì
    üìä Total: 15 cards
  
  A√ß√£o 2:
    GET /repos/{owner}/{repo}/commits
    Listar √∫ltimos 5
    ‚Üì
    üìù √öltimos commits:
    1. Fix bug - Jo√£o
    2. New feature - Maria
    ...
    ‚Üì
[Combinar Resultados]
  üìä Total: 15 cards
  
  üìù √öltimos commits:
  1. Fix bug - Jo√£o
  2. New feature - Maria
  ...
```

---

### ‚ö†Ô∏è Caso 4: Confirma√ß√£o Necess√°ria

```
Usu√°rio: "@bot crie uma issue urgente"
    ‚Üì
[Intent Classifier]
  Inten√ß√£o: ACTION
  MCP: GitHub
  A√ß√£o: create_issue
  Par√¢metros: {title: null, labels: ["urgent"]}
  Confidence: 0.75
  Requires Confirmation: TRUE ‚ö†Ô∏è
    ‚Üì
[Verifica√ß√£o]
  if requires_confirmation:
    return suggested_response
    ‚Üì
[Resultado]
  Para criar a issue urgente, preciso do t√≠tulo e descri√ß√£o. 
  Pode fornecer?
```

---

## Controle de Duplica√ß√£o

### Sistema de Timestamp + Set

```python
# Inicializa√ß√£o
startup_time = time.time()  # Ex: 1730000000.123
processed_messages = set()

# Em cada itera√ß√£o
for message in history:
    msg_ts = float(message['ts'])  # Ex: 1730000045.456
    msg_id = f"{channel_id}_{msg_ts}"
    
    # Dupla verifica√ß√£o
    if msg_ts > startup_time and msg_id not in processed_messages:
        # √â uma mensagem NOVA
        processed_messages.add(msg_id)
        process_message()
```

**Vantagens:**
- ‚úÖ Zero duplica√ß√µes
- ‚úÖ Mem√≥ria controlada (apenas mensagens novas)
- ‚úÖ Performance O(1)

---

## Logs de Processamento

### Exemplo de Log Completo

```
[18:30:45] #teste: 1 nova(s) mensagem(ns)
============================================================
NOVA MENCAO em #teste
Pergunta: criar card Bug na API na lista Backlog
============================================================

18:30:45 - Processando pergunta: criar card Bug na API na lista Backlog
üîç Classificando inten√ß√£o...
üìã Inten√ß√£o: ACTION (confian√ßa: 98%)
A√ß√µes identificadas: 1
  1. [TRELLO] create_card (prioridade: 1)

  Executando: [TRELLO] create_card
A√ß√£o executada: ‚úÖ Card 'Bug na API' criado na lista 'Backlog' com sucesso!
[OK] Resposta enviada para #teste
```

---

## M√©tricas de Performance

| M√©trica | Valor | Observa√ß√£o |
|---------|-------|------------|
| **Tempo de resposta** | ~2-5s | Depende da complexidade |
| **Taxa de classifica√ß√£o correta** | ~95% | Com GPT-4o-mini |
| **Fallback rate** | ~5% | Usa regex quando necess√°rio |
| **Duplica√ß√µes** | 0% | Sistema timestamp + set |
| **Mem√≥ria (24h)** | ~2 MB | Apenas mensagens novas |
| **API calls/minuto** | ~12 | Polling a cada 5s |

---

## Diagrama de Estado

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   IDLE      ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ (Aguardando)‚îÇ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
       ‚îÇ                   ‚îÇ
       ‚îÇ Nova mensagem     ‚îÇ
       ‚ñº                   ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ CLASSIFYING ‚îÇ            ‚îÇ
‚îÇ(Analisando) ‚îÇ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
       ‚îÇ                   ‚îÇ
       ‚îÇ Classificado      ‚îÇ
       ‚ñº                   ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ EXECUTING   ‚îÇ            ‚îÇ
‚îÇ(Executando) ‚îÇ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
       ‚îÇ                   ‚îÇ
       ‚îÇ Conclu√≠do         ‚îÇ
       ‚ñº                   ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ RESPONDING  ‚îÇ            ‚îÇ
‚îÇ(Enviando)   ‚îÇ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
       ‚îÇ                   ‚îÇ
       ‚îÇ Enviado           ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Resumo dos Componentes

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  CAMADA DE INTERFACE                   ‚îÇ
‚îÇ                      (Slack API)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               CAMADA DE ORQUESTRA√á√ÉO                   ‚îÇ
‚îÇ             (SlackLangGraphAgent)                      ‚îÇ
‚îÇ  ‚Ä¢ Polling                                             ‚îÇ
‚îÇ  ‚Ä¢ Detec√ß√£o de men√ß√µes                                 ‚îÇ
‚îÇ  ‚Ä¢ Coordena√ß√£o                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            CAMADA DE INTELIG√äNCIA                      ‚îÇ
‚îÇ          (IntentClassifierAgent + GPT-4o-mini)         ‚îÇ
‚îÇ  ‚Ä¢ An√°lise de linguagem natural                        ‚îÇ
‚îÇ  ‚Ä¢ Classifica√ß√£o de inten√ß√µes                          ‚îÇ
‚îÇ  ‚Ä¢ Extra√ß√£o de par√¢metros                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              CAMADA DE EXECU√á√ÉO                        ‚îÇ
‚îÇ           (execute_classified_action)                  ‚îÇ
‚îÇ  ‚Ä¢ Roteamento para MCPs                                ‚îÇ
‚îÇ  ‚Ä¢ Execu√ß√£o de a√ß√µes                                   ‚îÇ
‚îÇ  ‚Ä¢ Combina√ß√£o de resultados                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               CAMADA DE INTEGRA√á√ÉO                     ‚îÇ
‚îÇ              (Trello, GitHub, Slack MCPs)              ‚îÇ
‚îÇ  ‚Ä¢ APIs REST                                           ‚îÇ
‚îÇ  ‚Ä¢ Autentica√ß√£o                                        ‚îÇ
‚îÇ  ‚Ä¢ Transforma√ß√£o de dados                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Status Atual

‚úÖ **Sistema Completo e Funcional**
‚úÖ **2 Agents Trabalhando em Conjunto**
‚úÖ **3 MCPs Integrados**
‚úÖ **Classifica√ß√£o Inteligente**
‚úÖ **Fallback Robusto**
‚úÖ **Zero Duplica√ß√µes**
‚úÖ **Logs Detalhados**

---

**Sistema pronto para gerenciar projetos de forma inteligente e aut√¥noma!** üöÄü§ñ

